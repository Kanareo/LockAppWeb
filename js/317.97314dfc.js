"use strict";(self["webpackChunkvue_app"]=self["webpackChunkvue_app"]||[]).push([[317],{4810:function(e,s,t){t.r(s),t.d(s,{default:function(){return A}});var i=t(3396),c=t(7139),r=t(9242);const a=e=>((0,i.dD)("data-v-1f533eee"),e=e(),(0,i.Cn)(),e),h={class:"content"},n={class:"wrapper"},o={class:"center"},l={class:"sim"},d=a((()=>(0,i._)("option",{disabled:"",value:""},"Select lock to emulate",-1))),u={key:0},g=a((()=>(0,i._)("h2",null,"LockSimulator",-1))),k={class:"form-group"},p=a((()=>(0,i._)("label",{for:"name"},"Credentials",-1))),m={class:"buttons"};function f(e,s,t,a,f,M){const w=(0,i.up)("Message"),y=(0,i.up)("MainLayout");return(0,i.wg)(),(0,i.j4)(y,null,{default:(0,i.w5)((()=>[(0,i._)("div",h,[(0,i._)("div",n,[(0,i._)("div",o,[(0,i._)("div",l,[(0,i.wy)((0,i._)("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>f.selected=e)},[d,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(this.locks,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.key},(0,c.zw)(e.ID),1)))),128))],512),[[r.bM,f.selected]]),f.selected?((0,i.wg)(),(0,i.iD)("div",u,[g,(0,i._)("div",k,[p,(0,i.wy)((0,i._)("input",{type:"password",class:"form-control",id:"name",required:"","onUpdate:modelValue":s[1]||(s[1]=e=>f.credentials=e),name:"name"},null,512),[[r.nr,f.credentials]])]),(0,i._)("div",m,[(0,i._)("button",{onClick:s[2]||(s[2]=(...e)=>M.validate&&M.validate(...e)),class:"btn btn-success"},"Send"),(0,i._)("button",{onClick:s[3]||(s[3]=(...e)=>M.authorizeAccess&&M.authorizeAccess(...e)),class:"btn btn-success"}," WebAuth ")])])):(0,i.kq)("",!0)])])])]),((0,i.wg)(),(0,i.j4)(i.lR,{to:"body"},[(0,i.Wm)(w,{messageType:f.messageType,show:f.showMessage,message:f.messageContent,closeMessage:M.closeMessage},null,8,["messageType","show","message","closeMessage"])]))])),_:1})}var M=t(2393),w=t(1178),y=t(6797),v=t.n(y),C=t(6170),b=t(5871),L={name:"LockSim",components:{MainLayout:b.Z,Message:C.Z},data(){return{usersDB:[],locks:[],selected:"",currentUser:"",showSim:!1,credentials:"",codeCheck:!1,id:"",tries:3,scheduleT:[],authType:"",showMessage:!1,messageType:"",messageContent:""}},watch:{selected:function(){this.clearMem(),this.selectLock()}},methods:{printMessage(e,s){this.showMessage=!0,this.messageType=e,this.messageContent=s},closeMessage(){this.showMessage=!1},clearMem(){this.credentials="",this.codeCheck=!1,this.id="",this.tries=3,this.currentUser=""},onDataChange(e){let s=[];e.forEach((e=>{s.push({ID:e.key})})),this.locks=s},onDataChangeUsers(e){let s=[];e.forEach((e=>{let t=e.val();s.push({code:e.key,ID:t.ID,pass:t.pass,blocked:t.blocked})})),this.usersDB=s},validate(){"c"===this.authType?this.cAuth():"c+w"===this.authType?this.c_wAuth():"cw"===this.authType&&this.cwAuth()},cAuth(){let e={credentials:this.credentials};if(this.checkCode(e)&&!1===this.codeCheck){if(this.checkBlocked(e))return this.printMessage("warning","Account currently blocked, contact administrator"),void this.clearMem();this.currentUser=this.credentials,this.printMessage("info","Input password"),this.credentials="",this.codeCheck=!0}else if(!0===this.codeCheck)if(this.checkPas(e))this.tries=3,this.codeCheck=!1,this.credentials="",this.printMessage("success","Lock unlocked");else{if(this.tries--,0==this.tries)return this.printMessage("warning","Account temporary blocked"),void this.blockUser(this.currentUser);this.printMessage("warning","Invalid password. Tries remaining "+this.tries)}else this.credentials="",this.printMessage("warning","Invalid credentials")},c_wAuth(){let e={credentials:this.credentials};if(this.checkCode(e)&&!1===this.codeCheck){if(this.checkBlocked(e))return this.printMessage("warning","Account currently blocked, contact administrator"),void this.clearMem();this.printMessage("info","Input password"),this.currentUser=this.credentials,this.credentials="",this.codeCheck=!0}else if(!0===this.codeCheck)if(this.checkPas(e)){if(this.tries=3,this.codeCheck=!1,this.credentials="",!this.checkSchedule())return this.printMessage("info","You are off schedule, wait for authentication"),void this.updateLockAuth();this.printMessage("success","Lock unlocked")}else{if(this.tries--,0==this.tries)return this.printMessage("warning","Account temporary blocked"),void this.blockUser(this.currentUser);this.printMessage("warning","Invalid password. Tries remaining "+this.tries)}else this.credentials="",this.printMessage("warning","Invalid credentials")},cwAuth(){let e={credentials:this.credentials};if(this.checkCode(e)&&!1===this.codeCheck){if(this.checkBlocked(e))return this.printMessage("warning","Account currently blocked, contact administrator"),void this.clearMem();if(!this.checkSchedule())return this.printMessage("warning","Come back during your schedule!"),void this.clearMem();this.printMessage("info","Input password"),this.currentUser=this.credentials,this.credentials="",this.codeCheck=!0}else if(!0===this.codeCheck)if(this.checkPas(e))this.tries=3,this.codeCheck=!1,this.credentials="",this.printMessage("info","Wait for authentication"),this.updateLockAuth();else{if(this.tries--,0==this.tries)return this.printMessage("warning","Account temporary blocked"),void this.blockUser(this.currentUser);this.printMessage("warning","Invalid password. Tries remaining "+this.tries)}else this.credentials="",this.printMessage("warning","Invalid credentials")},checkCode(e){let s=!1;return this.usersDB.forEach((t=>{e.credentials==t.code&&(this.id=t.ID,s=!0)})),s},checkPas(e){let s=!1;return this.usersDB.forEach((t=>{e.credentials==t.pass&&this.id==t.ID&&(this.id=t.ID,s=!0)})),s},checkBlocked(e){let s=!0;for(let t=0;t<this.usersDB.length;t++)this.usersDB[t].code==e.credentials&&(s=this.usersDB[t].blocked);return s},selectLock(){let e;this.showSim=!0,(0,w.jM)(M.Z.getFromPath("/locks/"+this.selected+"/users"),(s=>{e=s,this.onDataChangeUsers(e)})),(0,w.jM)(M.Z.getFromPath("locks/"+this.selected+"/info/authType"),(s=>{e=s,e.exists()?this.authType=e.val():this.authType="c"}))},updateLockAuth(){const e=v()().format("LLL"),s={};s["/locks/"+this.selected+"/auth/lock"]=e,M.Z.update(s).catch((e=>{console.log(e),this.printMessage("danger","Error occured, report it to administrator!")}))},authorizeAccess(){let e;(0,w.U2)(M.Z.getFromPath("/locks/"+this.selected+"/auth/lock")).then((s=>{if(e=s.val(),""==e||null==e)this.printMessage("warning","Wait for user first!");else{let s=v()().format("LLL"),t=v()(s,"LLL").diff(v()(e,"LLL"),"minutes");t<=1&&t>=-1?this.openLock():this.clearAuthorization()}}))},clearAuthorization(){const e={};e["/locks/"+this.selected+"/auth/lock"]="",M.Z.update(e).then((()=>{this.printMessage("warning","Time difference is too great!")})).catch((e=>{console.log(e),this.printMessage("danger","Error occured, report it to administrator!")}))},openLock(){const e={};e["/locks/"+this.selected+"/auth/lock"]="",M.Z.update(e).then((()=>{this.printMessage("success","Lock unlocked")})).catch((e=>{console.log(e),this.printMessage("danger","Error occured, report it to administrator!")}))},getCurrentDay(){let e,s=v()().day();return 0===s?e="Sunday":1===s?e="Monday":2===s?e="Tuesday":3===s?e="Wednesday":4===s?e="Thursday":5===s?e="Friday":6===s&&(e="Saturday"),e},getSchedule(){let e;(0,w.jM)(M.Z.getFromPath("/locks/"+this.selected+"/schedule/"+this.id),(s=>{e=s,this.scheduleList(e)}))},scheduleList(e){let s=[];e.forEach((e=>{let t=e.val();s.push({ID:e.key,start:t.start.hour+":"+t.start.min,end:t.end.hour+":"+t.end.min,day:t.day})})),this.scheduleT=s},checkSchedule(){this.getSchedule();let e="hh:mm:ss a",s=v()(),t=this.getCurrentDay(),i=!1;for(let c=0;c<this.scheduleT.length;c++)this.scheduleT[c].day===t&&s.isBetween(v()(this.scheduleT[c].start,e),v()(this.scheduleT[c].end,e))&&(i=!0);return i},blockUser(e){const s={};s["/locks/"+this.selected+"/users/"+e+"/blocked"]=!0,M.Z.update(s).then((()=>{this.clearMem()})).catch((e=>{console.log(e),this.printMessage("danger","Error occured, report it to administrator!")}))}},mounted(){let e;(0,w.jM)(M.Z.getFromPath("/locksList"),(s=>{e=s,this.onDataChange(e)}))}},D=t(89);const T=(0,D.Z)(L,[["render",f],["__scopeId","data-v-1f533eee"]]);var A=T}}]);
//# sourceMappingURL=317.97314dfc.js.map